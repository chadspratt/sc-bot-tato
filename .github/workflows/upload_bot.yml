# This is a basic workflow that is manually triggered
name: Upload Bot

# Controls when the action will run. Workflow runs when manually triggered using the UI
# or API. 
on:
  push:
    branches:
      - main

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "greet"
  package:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
    - name: Checkout sc-bot-tato
      uses: actions/checkout@v4

    - name: Checkout python-sc2
      uses: actions/checkout@v4
      with:
        sparse-checkout: sc2
        repository: chadspratt/python-sc2
        path: temp-python-sc2

    - name: Copy sc2 directory
      run: cp -r temp-python-sc2/sc2 .

    - name: Debug - List bottato directory
      run: |
        echo "=== Contents of bottato directory ==="
        ls -la bottato/
        echo "=== Checking for old files ==="
        ls -la bottato/build_step.py 2>&1 || echo "build_step.py not found in bottato/"
        ls -la bottato/build_order.py 2>&1 || echo "build_order.py not found in bottato/"
        ls -la bottato/map.py 2>&1 || echo "map.py not found in bottato/"
        echo "=== Contents of bottato/building ==="
        ls -la bottato/building/

    # Runs a single command using the runners shell
    - name: Zip Files
      run: zip -r bottato.zip sc2 bottato __init__.py ladderbots.json LICENSE README.md bot.py run.py
    
    - name: Debug - Check zip contents
      run: |
        echo "=== Contents of zip file ==="
        unzip -l bottato.zip | grep -E "(build_step|build_order|map\. py)"
    
    - name: Upload
      env:
        AI_ARENA_API_KEY: ${{ secrets.AI_ARENA_API_KEY }}
      run: python upload_bot.py
